<!doctype html>
<html>

<head>
	<title>Are We Async Yet?</title>
	<script src="moment.min.js"></script>
	<script src="Chart.min.js"></script>
	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div style="width:75%;">
		<canvas id="canvas"></canvas>
	</div>

	<script>
		var config = {
			type: 'line',
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Are We Async Yet?'
				},
				tooltips: {
					mode: 'index',
				},
				hover: {
					mode: 'index'
				},
				scales: {
					xAxes: [{
						type: 'time',
						time: {
							"unit": "month",
						},
						distribution: 'series',
						scaleLabel: {
							display: true,
							labelString: 'Date'
						}
					}],
					yAxes: [{
						stacked: true,
						scaleLabel: {
							display: true,
							labelString: 'Count'
						}
					}]
				}
			}
		};

        fetch("results.json").then(response => response.json()).then(data => {
        	// Generate the data points from the raw data.
			let labels = [];
			let inlineDeferreds = [];
			let asyncDefs = [];

			for (let d of data.reverse()) {
				labels.push(d[1]);
				inlineDeferreds.push(d[2][0]);
				asyncDefs.push(d[3][0]);
			}

			// Finish up the config.
			config.data = {
				labels: labels,
				datasets: [
					{
						label: 'inlineDeferred',
						borderColor: "rgb(255, 99, 132)",  // Red
						backgroundColor: "rgb(255, 99, 132)",
						data: inlineDeferreds,
					}, {
						label: 'async',
						borderColor: "rgb(54, 162, 235)",  // Blue
						backgroundColor: "rgb(54, 162, 235)",
						data: asyncDefs,
					},
				]
			};

			// Render the graph.
			let ctx = document.getElementById('canvas').getContext('2d');

			window.chart = new Chart(ctx, config);
	  	});
	</script>
</body>

</html>
